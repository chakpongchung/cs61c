# Memory

存储器层结构可以由多层构成,但是数据每次只能在相邻的两个层次之间复制.  
将一个两级层结构中存储信息交换的最小单元称为block  

命中时间: 指访问存储器层结构中的高层存储器所需要的时间,包括了判断当前访问是命中还是缺失所需要的时间.  

缺失代价:将相应的块从低层存储器替换到高层存储器所需要的时间,包括访问块,将数据逐层传输,将数据插入发生缺失的层将信息块传输给请求者的时间.  

如果命中率足够高,存储器层次结构就会拥有接近最高层次的访问速度和接近最低层次的容量.

直接映射: 一种cache的结构,其中每个存储器地址仅仅对应到cache中的一个位置.  

标记: 表中的一个字段,包含了地址信息,这些地址信息可以用来判断cache中的字是否就是所请求的字.  

有效位: 表中的一个字段,用来标识一个块是否含有一个有效数据.  

由于cache不仅储存数据也储存标记位,cache所需的总位数是cache的大小和地址位数的函数.  

较大的cache块能够更好地利用空间局部性以降低缺失率.而当块大小在cache容量占比增加到一定程度时,缺失率也随之增加,因为此时cache中的块数量变得很少,  
对于这些块会有大量的竞争发生,结果一个块中的数据在被多次访问之前就被替换出cache.仅仅增加块的大小会导致缺失成本的增加.  

缺失时,较大的块会带来长延迟从而增加了缺失代价.简单方法是提前重启(early restart),当块中所需  
字一旦返回就马上继续执行.  
cache缺失处理由两部分共同完成: 处理器控制单元,以及一个进行初始化主存访问和重新填充cache的独立控制器.
cache缺失引起流水线阻塞.当cache缺失,等待主存操作完成,整个处理器阻塞,临时寄存器和程序员可见的寄存器中的内容
基本被冻结.  
cache缺失处理步骤:  

1. PC的原始值(PC-4)送到存储器中.
2. 通知主存进行一次读操作,等待其完成.
3. 写cache项.
4. 重启指令执行第一步.
  
write-through: 写操作总是同时更新cache和下一存储器层次,保持两者一致性.  
策略分配cache中的一块,称为write allocate.数据块从主存中取回,并且在该块中的恰当区域重写数据.
另一种策略是只更新主存中块的一部分,而不写入cache(no write allocate)
write-buffer: 当一个数据在等待被写入主存时,先将它放入写缓冲中.当把数据写入cache和写缓冲
中,处理器可以继续执行.当写主存操作完成后,写缓冲里的数据项也得到释放.如果缓冲区满了,
那么当处理器执行到一个写操作时必须停下来直到缓冲器中有一个空位置.  
write-back: 当发生写操作时,新值仅仅被写入cache块中,只有当修改过的块被替换时才写到
较低的层存储结构中.  

## cache 性能评估和改进

第一种技术通过减少存储器中不同的数据块争用cache中同一位置的概率来降低缺失率.  
第二种技术通过在存储器层次结构中额外增加一层来减少缺失代价(多级高速缓存)  

fully associative :cache的一种组织方式,块可以放到cache中的任何位置.  
set associative : 块可以放到cache中的部分位置
